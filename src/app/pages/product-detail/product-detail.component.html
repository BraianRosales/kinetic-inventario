<div class="productDetail">
  <div class="productDetail-backButton">
    <button mat-stroked-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon>
      <span>Volver</span>
    </button>
  </div>

  <div
    class="productDetail-content"
    *ngIf="product$ | async as product; else loading"
  >
    <h1>{{ product.name }}</h1>
    <div class="productDetail-content-info">
      <p><strong>Descripción:</strong> {{ product.description }}</p>
      <p><strong>Precio:</strong> ${{ product.price }}</p>
      <p><strong>Stock:</strong> {{ product.stock }} unidades</p>
      <p><strong>Marca:</strong> {{ product.brand }}</p>
      <p><strong>Ubicación:</strong> {{ product.location }}</p>
      <p><strong>Categorías:</strong> {{ product.categories.join(", ") }}</p>
    </div>

    <div class="productDetail-content-charts" *ngIf="(movements$ | async)?.length">
      <h2>Análisis de Datos</h2>
      <div class="charts-container">
        <div class="chart-item">
          <canvas baseChart
            [data]="lineChartData"
            [options]="lineChartOptions"
            [type]="lineChartType">
          </canvas>
        </div>
        <div class="chart-item">
          <canvas baseChart
            [data]="barChartData"
            [options]="barChartOptions"
            [type]="barChartType">
          </canvas>
        </div>
      </div>
    </div>

    <div class="productDetail-content-movements">
      <h2>Historial de Movimientos</h2>
      <div
        class="movements-list"
        *ngIf="(movements$ | async)?.length; else noMovements"
      >
        <div class="movement-item" *ngFor="let movement of movements$ | async">
          <div
            class="movement-icon"
            [ngClass]="getMovementColor(movement.type)"
          >
            <mat-icon>{{ getMovementIcon(movement.type) }}</mat-icon>
          </div>
          <div class="movement-details">
            <div class="movement-quantity" [ngClass]="movement.type">
              {{ movement.type === "IN" ? "+" : "" }}{{ movement.quantity }}
            </div>
            <div class="movement-reason">{{ movement.reason }}</div>
            <div class="movement-date">
              {{ movement.date | date : "dd/MM/yyyy HH:mm" }}
            </div>
          </div>
          <div class="movement-stock">
            {{ movement.previousStock }} → {{ movement.newStock }}
          </div>
        </div>
      </div>

      <ng-template #noMovements>
        <p class="no-movements">
          No hay movimientos registrados para este producto.
        </p>
      </ng-template>
    </div>
  </div>

  <ng-template #loading>
    <p>Cargando producto...</p>
  </ng-template>
</div>
